function cookieToArray(){sidarr=getCookie("cartsid")?getCookie("cartsid").split(","):[],numarr=getCookie("cartnum")?getCookie("cartnum").split(","):[]}function createcart(i,t){$.ajax({type:"post",url:"php/cart.php",async:!1,success:function(r){for(var r=JSON.parse(r),a=0;a<r.length;a++)if(i==r[a].id){var n=$(".wrap:hidden").clone(!0);n.find(".wrapfootr").find(".tw img").attr("src",r[a].imgsrc),n.find(".wrapfootr").find(".tw img").attr("sid",r[a].id),n.find(".wrapfootr").find(".tw span").html(r[a].txt),n.find(".wrapfootr").find(".five .price").html("￥"+r[a].price),n.find(".wrapfootr").find(".six .numshuru").val(t);var o=parseFloat(r[a].price);n.find(".wrapfootr").find(".four a").html((o*t).toFixed(2)),n.css("display","block"),$(".peoplelgoods").append(n),kong()}}})}function kong(){getCookie("cartsid")?($(".cartempty").css("display","none"),$(".cartmain").css("display","block")):($(".cartempty").css("display","block"),$(".cartmain").css("display","none"))}function delgoodslist(i,t){for(var r=[],a=0;a<t.length;a++)i!=t[a]&&r.push(t[a]);numarr.splice(t.indexOf(i),1),sidarr=r,addCookie("cartsid",sidarr.toString(),7),addCookie("cartnum",numarr.toString(),7)}function totalprice(){var i=0;$(".wrapfootr:visible").each(function(){$(this).find(".one").find("input:checkbox").is(":checked")&&(i+=parseFloat($(this).find(".four").find("a").html()))}),$(".changefooter .three .middle").find("em").html("￥"+i.toFixed(2)),$(".changefooter .three .left").find("em").html($(".wrap:visible").find(".one input:checked").length)}function singlegoodsprice(i){return(parseFloat(i.parents(".wrapfootr").find(".five .price").html().substr(1))*parseInt(i.parents(".wrapfootr").find(".six input").val())).toFixed(2)}function setcookie(i){cookieToArray();var t=i.parents(".wrapfootr").find(".tw img").attr("sid");numarr[sidarr.indexOf(t)]=i.parents(".wrapfootr").find(".numshuru").val(),addCookie("cartnum",numarr.toString(),7),addCookie("cartnum",numarr.toString(),7)}$.ajax({type:"post",url:"php/cart.php",async:!1,success:function(i){for(var t=JSON.parse(i),r="",a=0;a<t.length-2;a++)r+='<ul  ><li><a href="##"><img imgindex="'+(a+1)+'" src="'+t[a].imgsrc+'"/></a></li><li><a href="##" class = "cartprice"><span>￥</span><span class="goodprice">'+t[a].price+'</span></a></li><li class = "txt"><a href="#">'+t[a].txt+'</a></li><li><a href="#" class="xl"><span>销量：</span><span class="xiaoliang">'+t[a].xiaolian+'</span></a></li><button class = "addcart">加入购物车</button></ul>';if((a=t.length-2)&&(r+='<ul style = "margin:0;"><li><a href="##"><img imgindex="'+(a+1)+'" src="'+t[a].imgsrc+'"/></a></li><li><a href="##" class = "cartprice"><span>￥</span><span class="goodprice">'+t[a].price+'</span></a></li><li class = "txt"><a href="#">'+t[a].txt+'</a></li><li><a href="#"><span>销量：</span><span class="xiaoliang">'+t[a].xiaolian+'</span></a></li><button class = "addcart">加入购物车</button></ul>'),$(".contentgood").html(r),getCookie("cartsid"))for(var n=getCookie("cartsid").split(","),o=getCookie("cartnum").split(","),a=0;a<n.length;a++)createcart(n[a],o[a])}});var sidarr=[],numarr=[];$(".addcart").on("click",function(){var i=$(this).parent("ul").find("li img").attr("imgindex");cookieToArray(),-1!=$.inArray(i,sidarr)?($(".wrapfootr:visible").each(function(){if(i==$(this).find(".tw img").attr("sid")){var t=$(this).find(".six").find("input").val();t++,$(this).find(".six").find("input").val(t);var r=parseFloat($(this).find(".five").find(".price").html().substr(1));$(this).find(".four").find("a").html((r*t).toFixed(2)),numarr[sidarr.indexOf(i)]=t,addCookie("cartnum",numarr.toString(),7)}}),totalprice()):(sidarr.push(i),addCookie("cartsid",sidarr.toString(),7),numarr.push(1),addCookie("cartnum",numarr.toString(),7),createcart(i,1),totalprice())}),kong(),$(".delcar").on("click",function(){cookieToArray(),$(this).parents(".wrap").remove(),delgoodslist($(this).parents(".wrap").find("img").attr("sid"),sidarr),totalprice()}),$(".changefooter .tw a:first").on("click",function(){$(".wrapfootr:visible").each(function(){$(this).find("input:checkbox").is(":checked")&&($(this).remove(),delgoodslist($(this).find("img").attr("sid"),sidarr))}),totalprice()}),$(".wrapfootr ul .one").on("click",function(){$(this).find("input:checked")&&totalprice()}),$("input:checkbox").on("change",function(){$(this).prop("checked")?$(".changefooter .right a").addClass("check"):$(".changefooter .right a").removeClass("check")}),$(".checkall").on("change",function(){$(this).prop("checked")?$(".wrapfootr:visible").find(".one").find("input:checkbox").prop("checked",!0):$(".wrapfootr:visible").find(".one").find("input:checkbox").prop("checked",!1),$(".checkall").prop("checked",$(this).prop("checked")),totalprice()});var $input=$(".wrapfootr:visible").find(".one").find("input:checkbox");$(".wrapfootr:visible").find(".one").find("input:checkbox").on("change",function(){$(".wrapfootr:visible").find(".one").find("input:checked").length==$input.size()?$(".checkall").prop("checked",!0):$(".checkall").prop("checked",!1),totalprice()}),$(".jiajia").on("click",function(){var i=$(this).parents(".wrapfootr").find(".numshuru").val();i++,i>=99&&(i=99),$(this).parents(".wrapfootr").find(".numshuru").val(i),$(this).parents(".wrapfootr").find(".four a").html(singlegoodsprice($(this))),totalprice(),setcookie($(this))}),$(".jianjian").on("click",function(){var i=$(this).parents(".wrapfootr").find(".numshuru").val();i--,i<=1&&(i=1),$(this).parents(".wrapfootr").find(".numshuru").val(i),$(this).parents(".wrapfootr").find(".four a").html(singlegoodsprice($(this))),totalprice(),setcookie($(this))}),$(".wrapfootr .six input").on("input",function(){var i=/^\d+$/g,t=$(this).val();i.test(t)?t>=99?$(this).val(99):t<=1?$(this).val(1):$(this).val(t):$(this).val(1),$(this).parents(".wrapfootr").find(".four a").html(singlegoodsprice($(this))),totalprice(),setcookie($(this))});